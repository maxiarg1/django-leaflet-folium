{% extends 'map/base.html' %}

{% block content %}

<div class="row">
    <div class="col-md-4">
        <h3>Dispositivos</h3>
        <p class="lead">Subtitulo</p>

        <ol class="list-group">

            {% for location in locations %}
            <li class="list-group-item d-flex justify-content-between align-items-start" data-ping-responde="{{ location.ping_responde|yesno:'true,false' }}">
                <div class="ms-2 me-auto">
                    <div class="fw-bold">{{ location.name }}</div>
                    {{ location.address }}
                </div>
                <span class="badge bg-{{ location.ping_responde|yesno:'success,danger' }}">{{ location.ping_responde|yesno:'Responde,No responde' }}</span>
            </li>
            {% endfor %}
        </ol>
    </div>
    <div class="col-md-8">
        {{ map|safe }}
    </div>
</div>

<script>
    function actualizarDatosPing() {
        // Realiza una solicitud AJAX para obtener la información de ping
        fetch('')
            .then(response => response.json())
            .then(data => {
                // Actualiza la información de ping en la página
                data.ping_info.forEach(item => {
                    const listItem = document.querySelector(`[data-location-id="${item.id}"]`);
                    if (listItem) {
                        listItem.dataset.pingResponde = item.ping_responde.toString();
                    }
                });

                // Programa la próxima actualización después de un intervalo de tiempo (por ejemplo, 1 minuto)
                setTimeout(actualizarDatosPing, 60000);  // 60000 milisegundos = 1 minuto
            })
            .catch(error => console.error('Error al obtener datos de ping:', error));
    }

    // Llama a la función inicialmente para iniciar el proceso de actualización
    actualizarDatosPing();
</script>
{% endblock %}
